{% extends 'centre_commercial/base_dashboard.html.twig' %}

{% block title %}Messages - Centre Commercial{% endblock %}

{% block dashboard_content %}

<div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
    <h1 class="page-title">Messages</h1>
    <a href="{{ path('centre_messages_archives') }}" class="btn-small btn-secondary-small">
        ðŸ“¦ Voir les archives
    </a>
</div>

{% if conversations is empty %}
    <div class="empty-state">
        <div class="empty-icon">ðŸ’¬</div>
        <div class="empty-title">Aucune conversation</div>
        <div class="empty-text">Vous n'avez aucune conversation avec vos locataires</div>
    </div>
{% else %}
    <div class="section">
        {% for item in conversations %}
            {% set conversation = item.conversation %}
            {% set nbNonLus = item.nbNonLus %}

            <div class="reservation-card" style="cursor: pointer;" onclick="window.location='{{ path('centre_messages_show', {id: conversation.id}) }}'">
                <div class="user-avatar" style="width: 60px; height: 60px; flex-shrink: 0;">
                    {% if conversation.locataire.photoProfile %}
                        <img src="{{ asset('uploads/profiles/' ~ conversation.locataire.photoProfile) }}"
                             alt="Avatar"
                             style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                    {% else %}
                        <div style="width: 100%; height: 100%; border-radius: 50%; background: linear-gradient(135deg, #1a1a1a, #333); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600;">
                            {{ conversation.locataire.nom|slice(0, 2)|upper }}
                        </div>
                    {% endif %}
                </div>

                <div class="reservation-info">
                    <h3>
                        {{ conversation.locataire.nom }}
                        {% if nbNonLus > 0 %}
                            <span style="background: #dc3545; color: white; border-radius: 12px; padding: 2px 8px; font-size: 12px; margin-left: 8px;">
                                {{ nbNonLus }}
                            </span>
                        {% endif %}
                    </h3>
                    <div class="reservation-details">
                        <strong>Sujet:</strong> {{ conversation.sujet }}
                    </div>
                    {% if conversation.reservation %}
                        <div class="reservation-details">
                            <strong>RÃ©servation:</strong> {{ conversation.reservation.emplacement.titreAnnonce }}
                        </div>
                    {% endif %}
                    <div class="reservation-details" style="color: #6b6b6b; font-size: 14px;">
                        Dernier message: {{ conversation.dernierMessageDate|date('d/m/Y H:i') }}
                    </div>
                </div>

                <div class="reservation-actions">
                    <a href="{{ path('centre_messages_show', {id: conversation.id}) }}" class="btn-small btn-primary-small">
                        ðŸ’¬ RÃ©pondre
                    </a>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

{% endblock %}
