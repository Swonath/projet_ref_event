{% extends 'centre_commercial/base_dashboard.html.twig' %}

{% block title %}Messages archiv√©s - Centre Commercial{% endblock %}

{% block dashboard_content %}

<div class="page-header">
    <h1 class="page-title">Messages archiv√©s üì¶</h1>
    <a href="{{ path('centre_messages_index') }}" class="btn-secondary">‚Üê Retour aux messages</a>
</div>

<!-- Flash messages -->
{% for message in app.flashes('success') %}
    <div class="alert alert-success">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('error') %}
    <div class="alert alert-error">{{ message }}</div>
{% endfor %}

{% if conversations is empty %}
    <div class="empty-state">
        <div class="empty-icon">üì¶</div>
        <div class="empty-title">Aucune conversation archiv√©e</div>
        <div class="empty-text">Les conversations que vous archivez appara√Ætront ici</div>
        <a href="{{ path('centre_messages_index') }}" class="btn-primary">Retour aux messages</a>
    </div>
{% else %}
    <div class="section">
        {% for item in conversations %}
            {% set conversation = item.conversation %}
            {% set nbNonLus = item.nbNonLus %}

            <div class="reservation-card" style="opacity: 0.8; border-left: 3px solid #6b6b6b;">
                <div class="user-avatar" style="width: 60px; height: 60px; flex-shrink: 0; background: #6b6b6b;">
                    {% if conversation.locataire.photoProfile %}
                        <img src="{{ asset('uploads/profiles/' ~ conversation.locataire.photoProfile) }}"
                             alt="Avatar"
                             style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                    {% else %}
                        <div style="width: 100%; height: 100%; border-radius: 50%; background: #6b6b6b; color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600;">
                            {{ conversation.locataire.nom|slice(0, 2)|upper }}
                        </div>
                    {% endif %}
                </div>

                <div class="reservation-info">
                    <h3>
                        <span style="background: #6b6b6b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-right: 8px;">ARCHIV√â</span>
                        {{ conversation.locataire.nom }}
                        {% if nbNonLus > 0 %}
                            <span style="background: #dc3545; color: white; border-radius: 12px; padding: 2px 8px; font-size: 12px; margin-left: 8px;">
                                {{ nbNonLus }}
                            </span>
                        {% endif %}
                    </h3>
                    <div class="reservation-details">
                        <strong>Sujet:</strong> {{ conversation.sujet }}
                    </div>
                    {% if conversation.reservation %}
                        <div class="reservation-details">
                            <strong>R√©servation:</strong> {{ conversation.reservation.emplacement.titreAnnonce }}
                        </div>
                    {% endif %}
                    <div class="reservation-details" style="color: #6b6b6b; font-size: 14px;">
                        Dernier message: {{ conversation.dernierMessageDate|date('d/m/Y H:i') }}
                    </div>
                </div>

                <div class="reservation-actions">
                    <a href="{{ path('centre_messages_show', {id: conversation.id}) }}" class="btn-small btn-primary-small">
                        üëÅÔ∏è Voir
                    </a>
                    <form method="POST" action="{{ path('centre_messages_unarchive', {id: conversation.id}) }}" style="display: inline; margin-left: 8px;">
                        <input type="hidden" name="_token" value="{{ csrf_token('unarchive_conversation_' ~ conversation.id) }}">
                        <button type="submit" class="btn-small btn-secondary-small" title="Restaurer la conversation">
                            ‚Ü©Ô∏è Restaurer
                        </button>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

{% endblock %}
