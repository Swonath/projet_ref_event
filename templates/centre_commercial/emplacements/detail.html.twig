{% extends 'centre_commercial/base_dashboard.html.twig' %}

{% block title %}{{ emplacement.titreAnnonce }} - Centre Commercial{% endblock %}

{% block dashboard_content %}

<div class="page-header">
    <h1 class="page-title">{{ emplacement.titreAnnonce }}</h1>
    <div style="display: flex; gap: 12px;">
        <a href="{{ path('centre_emplacements_index') }}" class="btn-secondary" style="width: auto; padding: 12px 24px;">‚Üê Retour √† la liste</a>
        <a href="{{ path('centre_emplacements_modifier', {id: emplacement.id}) }}" class="btn-primary" style="width: auto; padding: 12px 24px;">‚úèÔ∏è Modifier</a>
    </div>
</div>

<!-- Flash messages -->
{% for message in app.flashes('success') %}
    <div class="alert alert-success">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('error') %}
    <div class="alert alert-error">{{ message }}</div>
{% endfor %}

<div class="section">
    <h2 class="section-title">Informations</h2>

    <div class="info-grid">
        <div class="info-item">
            <strong>Type:</strong> {{ emplacement.typeEmplacement }}
        </div>
        <div class="info-item">
            <strong>Surface:</strong> {{ emplacement.surface }} m¬≤
        </div>
        <div class="info-item">
            <strong>Localisation:</strong> {{ emplacement.localisationPrecise }}
        </div>
        <div class="info-item">
            <strong>Statut:</strong>
            <span class="reservation-status status-{{ emplacement.statutAnnonce == 'active' ? 'validee' : 'inactive' }}">
                {{ emplacement.statutAnnonce == 'active' ? '‚úÖ Active' : '‚è∏Ô∏è Inactive' }}
            </span>
        </div>
    </div>

    <div style="margin-top: 20px;">
        <strong>Description:</strong>
        <p>{{ emplacement.description }}</p>
    </div>

    {% if emplacement.equipements %}
        <div style="margin-top: 20px;">
            <strong>√âquipements:</strong>
            <p>{{ emplacement.equipements }}</p>
        </div>
    {% endif %}
</div>

<div class="section">
    <h2 class="section-title">Tarification</h2>

    <div class="info-grid">
        <div class="info-item">
            <strong>Tarif journalier:</strong> {{ emplacement.tarifJour }}‚Ç¨
        </div>
        {% if emplacement.tarifSemaine %}
            <div class="info-item">
                <strong>Tarif hebdomadaire:</strong> {{ emplacement.tarifSemaine }}‚Ç¨
            </div>
        {% endif %}
        {% if emplacement.tarifMois %}
            <div class="info-item">
                <strong>Tarif mensuel:</strong> {{ emplacement.tarifMois }}‚Ç¨
            </div>
        {% endif %}
        <div class="info-item">
            <strong>Caution:</strong> {{ emplacement.caution }}‚Ç¨
        </div>
    </div>

    {% if emplacement.dureeMinLocation or emplacement.dureeMaxLocation %}
        <div style="margin-top: 20px;">
            <strong>Dur√©e de location:</strong>
            {% if emplacement.dureeMinLocation %}
                Minimum {{ emplacement.dureeMinLocation }} jour(s)
            {% endif %}
            {% if emplacement.dureeMaxLocation %}
                - Maximum {{ emplacement.dureeMaxLocation }} jour(s)
            {% endif %}
        </div>
    {% endif %}
</div>

<div class="section">
    <h2 class="section-title">Photos ({{ emplacement.photos|length }}/10)</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px;">
        {% for photo in emplacement.photos %}
            <div style="position: relative;">
                <img src="{{ asset('uploads/photos/' ~ photo.cheminFichier) }}"
                     alt="Photo"
                     style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                <form method="POST" action="{{ path('centre_emplacements_supprimer_photo', {photoId: photo.id}) }}"
                      style="position: absolute; top: 8px; right: 8px;"
                      onsubmit="return confirm('Supprimer cette photo ?')">
                    <input type="hidden" name="_token" value="{{ csrf_token('supprimer_photo_' ~ photo.id) }}">
                    <button type="submit" class="btn-small btn-secondary-small" style="background: rgba(255,255,255,0.9);">
                        üóëÔ∏è
                    </button>
                </form>
            </div>
        {% endfor %}

        {% if emplacement.photos|length < 10 %}
            <div style="border: 2px dashed #ccc; border-radius: 8px; padding: 40px; text-align: center;">
                <form method="POST" action="{{ path('centre_emplacements_ajouter_photo', {id: emplacement.id}) }}" enctype="multipart/form-data" id="photoUploadForm">
                    <label for="photoInput" style="cursor: pointer;">
                        <div>üì∑</div>
                        <div>Ajouter une photo</div>
                    </label>
                    <input type="file" id="photoInput" name="photo" accept="image/jpeg,image/png,image/webp"
                           style="display: none;" onchange="document.getElementById('photoUploadForm').submit()">
                </form>
            </div>
        {% endif %}
    </div>
</div>

<div class="section">
    <h2 class="section-title">P√©riodes d'indisponibilit√©</h2>

    {% if emplacement.periodesIndisponibilite is empty %}
        <p>Aucune p√©riode d'indisponibilit√© d√©finie.</p>
    {% else %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #e5e5e5;">
                    <th style="padding: 12px; text-align: left;">Du</th>
                    <th style="padding: 12px; text-align: left;">Au</th>
                    <th style="padding: 12px; text-align: left;">Motif</th>
                    <th style="padding: 12px; text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for periode in emplacement.periodesIndisponibilite %}
                    <tr style="border-bottom: 1px solid #e5e5e5;">
                        <td style="padding: 12px;">{{ periode.dateDebut|date('d/m/Y') }}</td>
                        <td style="padding: 12px;">{{ periode.dateFin|date('d/m/Y') }}</td>
                        <td style="padding: 12px;">{{ periode.motif ?? '-' }}</td>
                        <td style="padding: 12px; text-align: right;">
                            <form method="POST" action="{{ path('centre_emplacements_supprimer_periode_indispo', {periodeId: periode.id}) }}"
                                  style="display: inline;"
                                  onsubmit="return confirm('Supprimer cette p√©riode ?')">
                                <input type="hidden" name="_token" value="{{ csrf_token('supprimer_periode_' ~ periode.id) }}">
                                <button type="submit" class="btn-small btn-secondary-small">üóëÔ∏è Supprimer</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <div style="margin-top: 20px;">
        <h3>Ajouter une p√©riode d'indisponibilit√©</h3>
        {{ form_start(periodeForm, {'action': path('centre_emplacements_ajouter_periode_indispo', {id: emplacement.id})}) }}
            <div class="form-row">
                <div class="form-group">
                    {{ form_label(periodeForm.dateDebut) }}
                    {{ form_widget(periodeForm.dateDebut, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="form-group">
                    {{ form_label(periodeForm.dateFin) }}
                    {{ form_widget(periodeForm.dateFin, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="form-group">
                {{ form_label(periodeForm.motif) }}
                {{ form_widget(periodeForm.motif, {'attr': {'class': 'form-control'}}) }}
            </div>
            <button type="submit" class="btn-primary" style="width: auto; padding: 12px 24px;">Ajouter</button>
        {{ form_end(periodeForm) }}
    </div>
</div>

<div class="section">
    <h2 class="section-title">R√©servations ({{ reservations|length }})</h2>

    {% if reservations is empty %}
        <p>Aucune r√©servation pour cet emplacement.</p>
    {% else %}
        {% for reservation in reservations %}
            <div class="reservation-card">
                <div class="reservation-info">
                    <h3>{{ reservation.locataire.nom }}</h3>
                    <div class="reservation-details">
                        Du {{ reservation.dateDebut|date('d/m/Y') }} au {{ reservation.dateFin|date('d/m/Y') }}
                    </div>
                    <span class="reservation-status status-{{ reservation.statut.cssClass }}">
                        {{ reservation.statut.icone }} {{ reservation.statut.libelle }}
                    </span>
                </div>
                <div class="reservation-actions">
                    <div class="reservation-price">{{ reservation.montantTotal }} ‚Ç¨</div>
                    <a href="{{ path('centre_reservations_detail', {id: reservation.id}) }}" class="btn-small btn-primary-small">Voir</a>
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<div class="section">
    <h2 class="section-title" style="color: #dc3545;">Zone dangereuse</h2>
    <form method="POST" action="{{ path('centre_emplacements_supprimer', {id: emplacement.id}) }}"
          onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cet emplacement ? Cette action est irr√©versible.')">
        <input type="hidden" name="_token" value="{{ csrf_token('supprimer_' ~ emplacement.id) }}">
        <button type="submit" class="btn-secondary" style="color: #dc3545; border-color: #dc3545;">
            üóëÔ∏è Supprimer l'emplacement
        </button>
    </form>
</div>

<style>
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.info-item {
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
}
</style>

{% endblock %}
