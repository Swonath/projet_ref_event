{% extends 'locataire/base_dashboard.html.twig' %}

{% block title %}Messages archiv√©s - Locataire{% endblock %}

{% block dashboard_content %}

<div class="page-header">
    <h1 class="page-title">Messages archiv√©s üì¶</h1>
    <a href="{{ path('locataire_messages_index') }}" class="btn-secondary">‚Üê Retour aux messages</a>
</div>

<!-- Flash messages -->
{% for message in app.flashes('success') %}
    <div class="alert alert-success">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('error') %}
    <div class="alert alert-error">{{ message }}</div>
{% endfor %}

<div class="section">
    {% if conversations is empty %}
        <div class="empty-state">
            <div class="empty-icon">üì¶</div>
            <div class="empty-title">Aucune conversation archiv√©e</div>
            <div class="empty-text">Les conversations que vous archivez appara√Ætront ici</div>
            <a href="{{ path('locataire_messages_index') }}" class="btn-primary">Retour aux messages</a>
        </div>
    {% else %}
        <div class="conversations-list">
            {% for conversation in conversations %}
                <div class="conversation-card" style="opacity: 0.8; border-left: 3px solid #6b6b6b;">
                    <!-- Avatar du centre commercial -->
                    <div class="conversation-avatar" style="background: #6b6b6b;">
                        {{ conversation.centreCommercial.nomCentre|slice(0, 2)|upper }}
                    </div>

                    <!-- Informations de la conversation -->
                    <div class="conversation-info">
                        <div class="conversation-header">
                            <h3 class="conversation-name">{{ conversation.centreCommercial.nomCentre }}</h3>
                            <span class="conversation-date">
                                {% if conversation.dernierMessageDate %}
                                    {{ conversation.dernierMessageDate|date('d/m/Y H:i') }}
                                {% endif %}
                            </span>
                        </div>

                        <div class="conversation-subject">
                            <span style="background: #6b6b6b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-right: 8px;">ARCHIV√â</span>
                            {% if conversation.sujet %}
                                {{ conversation.sujet }}
                            {% elseif conversation.reservation %}
                                R√©servation : {{ conversation.reservation.emplacement.titreAnnonce }}
                            {% else %}
                                Conversation
                            {% endif %}
                        </div>

                        <!-- Aper√ßu du dernier message -->
                        {% set lastMessage = conversation.messages|last %}
                        {% if lastMessage %}
                            <div class="conversation-preview">
                                {% if lastMessage.typeExpediteur == 'locataire' %}
                                    <strong>Vous :</strong>
                                {% endif %}
                                {{ lastMessage.contenu|slice(0, 80) }}{% if lastMessage.contenu|length > 80 %}...{% endif %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <a href="{{ path('locataire_messages_show', {id: conversation.id}) }}" class="btn-small btn-primary-small">
                            üëÅÔ∏è Voir
                        </a>
                        <form method="POST" action="{{ path('locataire_messages_unarchive', {id: conversation.id}) }}" style="margin: 0;">
                            <input type="hidden" name="_token" value="{{ csrf_token('unarchive_conversation_' ~ conversation.id) }}">
                            <button type="submit" class="btn-small btn-secondary-small" title="Restaurer la conversation">
                                ‚Ü©Ô∏è Restaurer
                            </button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

{% endblock %}
