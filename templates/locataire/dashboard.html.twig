{% extends 'locataire/base_dashboard.html.twig' %}

{% block title %}Tableau de bord - Locataire{% endblock %}

{% block dashboard_content %}

<div class="page-header">
    <h1 class="page-title">Bonjour {{ locataire.nom }} ğŸ‘‹</h1>
    <p class="page-subtitle">Voici un aperÃ§u de votre activitÃ©</p>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">ğŸ“…</div>
        <div class="stat-value">{{ stats.reservations_actives }}</div>
        <div class="stat-label">RÃ©servations actives</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">ğŸ’¬</div>
        <div class="stat-value">{{ stats.messages_non_lus }}</div>
        <div class="stat-label">Messages non lus</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">â¤ï¸</div>
        <div class="stat-value">{{ stats.favoris }}</div>
        <div class="stat-label">Emplacements favoris</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-value">{{ stats.depenses_mois }}â‚¬</div>
        <div class="stat-label">DÃ©penses ce mois</div>
    </div>
</div>

<!-- RÃ©servations en cours -->
<div class="section">
    <div class="section-header">
        <h2 class="section-title">Mes rÃ©servations</h2>
        <a href="{{ path('locataire_reservations') }}" class="btn-link">Voir tout â†’</a>
    </div>

        {# Section 2 : Filtres par statut (gÃ©nÃ©rÃ©s dynamiquement depuis l'enum) #}
        <div class="filters-group">
            <span class="filters-label">Par statut :</span>
            <div class="filters">
                <a href="{{ path('locataire_reservations', {filtre: 'toutes'}) }}" 
               class="filter-btn active">
                Toutes ({{ stats.total_reservations }})
            </a>
                {% for statut in statuts %}
                    {% set statutValue = statut.value %}
                    {% set countKey = 'statut_' ~ statutValue %}
                    <a href="{{ path('locataire_reservations', {filtre: statutValue}) }}" 
                       class="filter-btn filter-btn-status status-{{ statut.cssClass }}">
                        {{ statut.icone }} {{ statut.libelle }}
                    </a>
                {% endfor %}
            </div>
        </div>
    
    {% if reservations is empty %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“…</div>
            <div class="empty-title">Aucune rÃ©servation active</div>
            <div class="empty-text">Vous n'avez pas de rÃ©servation en cours actuellement</div>
            <a href="{{ path('app_home_page') }}" class="btn-primary">Rechercher un emplacement</a>
        </div>
    {% else %}
        {% for reservation in reservations %}
        <div class="reservation-card">
            <div class="reservation-image">
                {% if reservation.emplacement.photos|length > 0 %}
                    <img src="{{ asset('uploads/photos/' ~ reservation.emplacement.photos[0].cheminFichier) }}" 
                         alt="{{ reservation.emplacement.titreAnnonce }}">
                {% else %}
                    <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#f5f5f5; color:#999;">
                        ğŸ“·
                    </div>
                {% endif %}
            </div>
            
            <div class="reservation-info">
                <h3>{{ reservation.emplacement.titreAnnonce }}</h3>
                <div class="reservation-details">
                    ğŸ“ {{ reservation.emplacement.centreCommercial.nomCentre }} â€¢ 
                    {{ reservation.emplacement.typeEmplacement }} â€¢ 
                    {{ reservation.emplacement.surface }} mÂ²
                </div>
                <div class="reservation-details">
                    ğŸ“… Du {{ reservation.dateDebut|date('d/m/Y') }} au {{ reservation.dateFin|date('d/m/Y') }}
                </div>
                {# âœ… Badge de statut avec enum #}
                <span class="reservation-status status-{{ reservation.statutCssClass }}">
                    {{ reservation.statut.icone }} {{ reservation.statutLibelle }}
                </span>
            </div>
            
            <div class="reservation-actions">
                <div class="reservation-price">{{ reservation.montantTotal }}â‚¬</div>
                <a href="{{ path('locataire_reservation_detail', {id: reservation.id}) }}" 
                   class="btn-small btn-primary-small">Voir dÃ©tails</a>
                <a href="#" class="btn-small btn-secondary-small">Contacter</a>
            </div>
        </div>
        {% endfor %}
    {% endif %}
</div>

<!-- Messages rÃ©cents -->
<div class="section">
    <div class="section-header">
        <h2 class="section-title">Messages rÃ©cents</h2>
        <a href="{{ path('locataire_messages_index') }}" class="btn-link">Voir tout â†’</a>
    </div>
    
    {% if messages is empty %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ’¬</div>
            <div class="empty-title">Aucun message</div>
            <div class="empty-text">Vous n'avez pas encore de messages</div>
        </div>
    {% else %}
        {% for message in messages %}
        <div class="reservation-card" style="grid-template-columns: 1fr auto;">
            <div class="reservation-info">
                <h3>{{ message.expediteur }}</h3>
                <div class="reservation-details">{{ message.contenu }}</div>
                <div class="reservation-details">
                    ğŸ• {{ message.date|date('d/m/Y Ã  H:i') }}
                </div>
            </div>
            <div class="reservation-actions">
                <a href="#" class="btn-small btn-primary-small">RÃ©pondre</a>
            </div>
        </div>
        {% endfor %}
    {% endif %}
</div>

{% endblock %}
