{% extends 'locataire/base_dashboard.html.twig' %}

{% block title %}Mes rÃ©servations - RÃ©fÃ©rences Ã‰vÃ©nements{% endblock %}

{% block dashboard_content %}

<div class="section">
<div class="page-header">
    <h1 class="page-title">Mes rÃ©servations</h1>
    <p class="page-subtitle">{{ reservations|length }} rÃ©servation{% if reservations|length > 1 %}s{% endif %} 
    {% if filtre_actif != 'toutes' %}{{ filtre_actif|replace({'_': ' '}) }}{% endif %}</p>
</div>

    {# Section 2 : Filtres par statut (gÃ©nÃ©rÃ©s dynamiquement depuis l'enum) #}
    <div class="filters-group">
        <span class="filters-label">Par statut :</span>
        <div class="filters">
            <a href="{{ path('locataire_reservations', {filtre: 'toutes'}) }}" 
               class="filter-btn {% if filtre_actif == 'toutes' %}active{% endif %}">
                Toutes ({{ stats.total_reservations }})
            </a>
            {% for statut in statuts %}
                {% set statutValue = statut.value %}
                {% set countKey = 'statut_' ~ statutValue %}
                <a href="{{ path('locataire_reservations', {filtre: statutValue}) }}" 
                   class="filter-btn filter-btn-status status-{{ statut.cssClass }} {% if filtre_actif == statutValue %}active{% endif %}">
                    {{ statut.icone }} {{ statut.libelle }} ({{ stats[countKey]|default(0) }})
                </a>
            {% endfor %}
        </div>
    </div>

    {% if reservations is empty %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ“…</div>
        <div class="empty-title">Aucune rÃ©servation active</div>
        <div class="empty-text">Vous n'avez pas de rÃ©servation en cours actuellement</div>
        <a href="{{ path('app_home_page') }}" class="btn-primary">Rechercher un emplacement</a>
    </div>
{% else %}
    {% for reservation in reservations %}
    <div class="reservation-card">
        <div class="reservation-image">
            {% if reservation.emplacement.photos|length > 0 %}
                <img src="{{ asset('uploads/photos/' ~ reservation.emplacement.photos[0].cheminFichier) }}" 
                     alt="{{ reservation.emplacement.titreAnnonce }}">
            {% else %}
                <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#f5f5f5; color:#999;">
                    ğŸ“·
                </div>
            {% endif %}
        </div>
        
        <div class="reservation-info">
            <h3>{{ reservation.emplacement.titreAnnonce }}</h3>
            <div class="reservation-details">
                ğŸ“ {{ reservation.emplacement.centreCommercial.nomCentre }} â€¢ 
                {{ reservation.emplacement.typeEmplacement }} â€¢ 
                {{ reservation.emplacement.surface }} mÂ²
            </div>
            <div class="reservation-details">
                ğŸ“… Du {{ reservation.dateDebut|date('d/m/Y') }} au {{ reservation.dateFin|date('d/m/Y') }}
            </div>
            {# âœ… Badge de statut avec enum #}
            <span class="reservation-status status-{{ reservation.statutCssClass }}">
                {{ reservation.statut.icone }} {{ reservation.statutLibelle }}
            </span>
        </div>
        
        <div class="reservation-actions">
            <div class="reservation-price">{{ reservation.montantTotal }}â‚¬</div>
            <a href="{{ path('locataire_reservation_detail', {id: reservation.id}) }}" 
               class="btn-small btn-primary-small">Voir dÃ©tails</a>
            <a href="#" class="btn-small btn-secondary-small">Contacter</a>
        </div>
    </div>
    {% endfor %}
{% endif %}
    </div>

{% endblock %}
