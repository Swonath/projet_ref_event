{% extends 'locataire/base_dashboard.html.twig' %}

{% block title %}Mes r√©servations - R√©f√©rences √©v√©nements{% endblock %}

{% block dashboard_content %}

<div class="section">
<div class="page-header">
    <h1 class="page-title">Mes r√©servations</h1>
    <p class="page-subtitle">{{ reservations|length }} r√©servation{% if reservations|length > 1 %}s{% endif %} 
    {% if filtre_actif != 'toutes' %}{{ filtre_actif|replace({'_': ' '}) }}{% endif %}</p>
</div>

    {# Section 2 : Filtres par statut (g√É¬©n√É¬©r√É¬©s dynamiquement depuis l'enum) #}
    <div class="filters-group">
        <span class="filters-label">Par statut :</span>
        <div class="filters">
            <a href="{{ path('locataire_reservations', {filtre: 'toutes'}) }}" 
               class="filter-btn {% if filtre_actif == 'toutes' %}active{% endif %}">
                Toutes ({{ stats.total_reservations }})
            </a>
            {% for statut in statuts %}
                {% set statutValue = statut.value %}
                {% set countKey = 'statut_' ~ statutValue %}
                <a href="{{ path('locataire_reservations', {filtre: statutValue}) }}" 
                   class="filter-btn filter-btn-status status-{{ statut.cssClass }} {% if filtre_actif == statutValue %}active{% endif %}">
                    {{ statut.icone }} {{ statut.libelle }} ({{ stats[countKey]|default(0) }})
                </a>
            {% endfor %}
        </div>
    </div>

    {% if reservations is empty %}
    <div class="empty-state">
        <div class="empty-icon"></div>
        <div class="empty-title">Aucune r√©servation active</div>
        <div class="empty-text">Vous n'avez pas de r√©servation en cours actuellement</div>
        <a href="{{ path('app_home_page') }}" class="btn-primary">Rechercher un emplacement</a>
    </div>
{% else %}
    {% for reservation in reservations %}
    <div class="reservation-card">
        <div class="reservation-image">
            {% if reservation.emplacement.photos|length > 0 %}
                <img src="{{ asset('uploads/photos/' ~ reservation.emplacement.photos[0].cheminFichier) }}" 
                     alt="{{ reservation.emplacement.titreAnnonce }}">
            {% else %}
                    <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#f5f5f5; color:#999;">
                        üì∑
                    </div>
                {% endif %}
        </div>
        
        <div class="reservation-info">
            <h3>{{ reservation.emplacement.titreAnnonce }}</h3>
            <div class="reservation-details">
                {{ reservation.emplacement.centreCommercial.nomCentre }} - 
                {{ reservation.emplacement.typeEmplacement }} -
                {{ reservation.emplacement.surface }} m¬≤
            </div>
            <div class="reservation-details">
                Du {{ reservation.dateDebut|date('d/m/Y') }} au {{ reservation.dateFin|date('d/m/Y') }}
            </div>
            {# √¢≈ì‚Ä¶ Badge de statut avec enum #}
            <span class="reservation-status status-{{ reservation.statutCssClass }}">
                {{ reservation.statut.icone }} {{ reservation.statutLibelle }}
            </span>
        </div>
        
        <div class="reservation-actions">
            <div class="reservation-price">{{ reservation.montantTotal }} ‚Ç¨</div>
            <a href="{{ path('locataire_reservation_detail', {id: reservation.id}) }}" 
               class="btn-small btn-primary-small">Voir d√©tails</a>
            <a href="#" class="btn-small btn-secondary-small">Contacter</a>
        </div>
    </div>
    {% endfor %}
{% endif %}
    </div>

{% endblock %}