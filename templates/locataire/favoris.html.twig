{% extends 'locataire/base_dashboard.html.twig' %}

{% block title %}Mes favoris - R√©f√©rences √âv√©nements{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/favoris.js') }}"></script>
    {# Initialiser les variables JavaScript depuis Twig #}
    <script>
        // Passer le total des favoris au JavaScript
        initialiserFavoris({{ totalFavoris }});
    </script>
{% endblock %}

{% block dashboard_content %}

<div class="section">
<div class="page-header">
    <h1 class="page-title">Mes favoris ‚ù§Ô∏è</h1>
    <p class="page-subtitle">{{ favoris|length }} emplacement{% if favoris|length > 1 %}s{% endif %} en favori</p>
</div>

{% if favoris is empty %}
    <div class="empty-state">
        <div class="empty-icon">‚ù§Ô∏è</div>
        <div class="empty-title">Aucun favori</div>
        <div class="empty-text">
            Vous n'avez pas encore d'emplacement en favori.<br>
            Ajoutez-en en cliquant sur le c≈ìur ‚ù§Ô∏è sur les annonces.
        </div>
        <a href="{{ path('app_home_page') }}" class="btn-primary">
            Rechercher un emplacement
        </a>
    </div>
{% else %}
    {% for favori in favoris %}
        {% set emplacement = favori.emplacement %}
        <div class="reservation-card" data-favori-id="{{ favori.id }}">
            <div class="reservation-image">
                {% if emplacement.photos|length > 0 %}
                    <img src="{{ asset('uploads/photos/' ~ emplacement.photos[0].cheminFichier) }}" alt="{{ emplacement.titreAnnonce }}">
                {% else %}
                    <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#f5f5f5; color:#999;">
                        üì∑
                    </div>
                {% endif %}
            </div>
            
            <div class="reservation-info">
                <h3>{{ emplacement.titreAnnonce }}</h3>
                <div class="reservation-details">
                    üìç {{ emplacement.centreCommercial.nomCentre }} ‚Ä¢ 
                    {{ emplacement.typeEmplacement }} ‚Ä¢ 
                    {{ emplacement.surface }} m¬≤
                </div>
                <div class="reservation-details">
                    ‚ù§Ô∏è Ajout√© le {{ favori.dateAjout|date('d/m/Y') }}
                </div>
                <span class="reservation-status status-disponible">
                    ‚úì Disponible
                </span>
            </div>
            
            <div class="reservation-actions">
                <div class="reservation-price">
                    {% if app.user and app.user.siret is defined and app.user.siret %}
                        {{ (emplacement.tarifJour * 1.25)|number_format(2, ',', ' ') }}‚Ç¨/jour
                    {% else %}
                        {{ emplacement.tarifJour }}‚Ç¨/jour
                    {% endif %}
                </div>
                <a href="{{ path('emplacement_detail', {id: emplacement.id}) }}"
                   class="btn-small btn-primary-small" style="width: 100%;">Voir d√©tails</a>
                <button class="btn-small btn-secondary-small" style="width: 100%;"
                        onclick="retirerDesFavoris({{ emplacement.id }}, this)"
                        data-delete-url="{{ path('locataire_favoris_retirer', {'id': emplacement.id}) }}"
                        title="Retirer des favoris">
                    Retirer ‚ù§Ô∏è
                </button>
            </div>
        </div>
    {% endfor %}
{% endif %}

{# Bouton Afficher Plus #}
{% if totalFavoris > 12 %}
<div id="load-more-container" style="text-align: center; margin-top: 30px;">
    <button id="btn-load-more"
            class="btn-primary"
            onclick="chargerPlusFavoris()"
            data-load-url="{{ path('locataire_favoris_charger_plus') }}"
            style="width: auto; padding: 12px 24px;">
        Afficher plus (<span id="favoris-affiches">12</span>/{{ totalFavoris }})
    </button>
</div>
{% endif %}
</div>

{% endblock %}
